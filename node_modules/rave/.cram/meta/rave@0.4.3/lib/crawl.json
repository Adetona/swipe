{"absId":"rave@0.4.3/lib/crawl","pluginId":"curl/loader/cjsm11","resourceId":"rave@0.4.3/lib/crawl","loader":true,"source":"define('rave@0.4.3/lib/crawl',['require','exports','module'],function(require,exports,module,define){/** @license MIT License (c) copyright 2014 original authors */\n/** @author Brian Cavalier */\n/** @author John Hann */\n\nvar npmCrawl = require('./crawl/npm').crawl;\nvar npmConvert = require('./convert/npm').convert;\nvar bowerCrawl = require('./crawl/bower').crawl;\nvar bowerConvert = require('./convert/bower').convert;\nvar path = require('./path');\n\nmodule.exports = crawl;\n\nvar fileTypeInfo = {\n\t'bower.json': {\n\t\tcrawl: bowerCrawl,\n\t\tconvert: bowerConvert\n\t},\n\t'package.json': {\n\t\tcrawl: npmCrawl,\n\t\tconvert: npmConvert\n\t}\n};\n\nfunction crawl (rootUrls) {\n\tif (typeof rootUrls === 'string') {\n\t\trootUrls = rootUrls.split(/\\s*,\\s*/);\n\t}\n\treturn Promise.all(rootUrls.map(crawlOne))\n\t\t.then(collapseMetadata);\n}\n\nfunction crawlOne (rootUrl) {\n\tvar fileParts, info;\n\n\tfileParts = path.splitDirAndFile(rootUrl);\n\tinfo = fileTypeInfo[fileParts[1]];\n\n\treturn info\n\t\t? info.crawl(info.convert, fileParts[0])['catch'](logError)\n\t\t: Promise.reject(new Error('Unknown metadata file: ' + rootUrl));\n}\n\nfunction collapseMetadata (tuples) {\n\treturn tuples.reduce(function (result, tuple) {\n\t\tif (!tuple || !tuple.root) return result;\n\t\tresult.roots.push(tuple.root);\n\t\ttuple.all.reduce(function (packages, data) {\n\t\t\tpackages[data.name] = packages[data.uid] = data;\n\t\t\treturn packages;\n\t\t}, result.packages);\n\t\treturn result;\n\t}, { roots: [], packages: {} });\n}\n\nfunction logError (ex) {\n\tconsole.error(ex);\n}\n\n});\n\n","modules":[{"pos":0,"count":100,"id":"rave@0.4.3/lib/crawl","depList":["require","exports","module"],"factory":true,"argList":["require","exports","module","define"],"requires":[{"id":"rave@0.4.3/lib/crawl/npm","pos":236,"count":22},{"id":"rave@0.4.3/lib/convert/npm","pos":283,"count":24},{"id":"rave@0.4.3/lib/crawl/bower","pos":334,"count":24},{"id":"rave@0.4.3/lib/convert/bower","pos":385,"count":26},{"id":"rave@0.4.3/lib/path","pos":432,"count":17}]}],"compileTime":"2014-11-17T20:58:47.373Z"}