{"absId":"rave@0.4.3/lib/convert/npm","pluginId":"curl/loader/cjsm11","resourceId":"rave@0.4.3/lib/convert/npm","loader":true,"source":"define('rave@0.4.3/lib/convert/npm',['require','exports','module'],function(require,exports,module,define){/** @license MIT License (c) copyright 2014 original authors */\n/** @author Brian Cavalier */\n/** @author John Hann */\n\nvar common = require('./common');\nvar path = require('../path');\nvar normalize = require('../../pipeline/normalizeCjs');\n\nvar transform = common.transform;\nvar createDeps = common.createDeps;\n\n// main exports\n\nexports.convert = npmConvert;\n\n// exports for testing\n\nexports.npmFixups = npmFixups;\nexports.npmBrowserMap = npmBrowserMap;\n\nfunction npmConvert (data) {\n\treturn npmFixups(transform(data));\n}\n\nfunction npmFixups (data) {\n\tvar metadata, main;\n\tmetadata = data.metadata;\n\tmain = (typeof metadata.browser === \"string\" && metadata.browser)\n\t\t|| data.main || 'index';\n\tdata.main = path.removeExt(main);\n\tif (typeof metadata.browser === 'object') {\n\t\tdata.mapFunc = npmBrowserMap(normalizeMap(metadata.browser, path.joinPaths(data.name, data.main)));\n\t}\n\tif (metadata.directories && metadata.directories.lib) {\n\t\tdata.location = path.joinPaths(data.location, metadata.directories.lib);\n\t}\n\treturn data;\n}\n\nfunction normalizeMap (map, refId) {\n\tvar normalized = {}, path;\n\tfor (path in map) {\n\t\tnormalized[normalize(path, refId)] = map[path]\n\t\t\t? normalize(map[path], refId)\n\t\t\t: false;\n\t}\n\treturn normalized;\n}\n\nfunction npmBrowserMap (normalized) {\n\treturn function (name) {\n\t\tif (name in normalized) {\n\t\t\treturn normalized[name] === false ? false : normalized[name];\n\t\t}\n\t};\n}\n\n});\n\n","modules":[{"pos":0,"count":106,"id":"rave@0.4.3/lib/convert/npm","depList":["require","exports","module"],"factory":true,"argList":["require","exports","module","define"],"requires":[{"id":"rave@0.4.3/lib/convert/common","pos":240,"count":19},{"id":"rave@0.4.3/lib/path","pos":272,"count":18},{"id":"rave@0.4.3/pipeline/normalizeCjs","pos":308,"count":38}]}],"compileTime":"2014-11-17T20:58:47.366Z"}